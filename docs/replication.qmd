---
title: "Untitled"
format: html
---


```{r}
#| label: data

load(file = here::here("data", "scotus_data_combined.rda"))

d < scotus_data_combined

d$year <- d$SCOTUS_year

ggplot(d) +
  aes(x = year |> as.factor() ) +
  geom_bar(position = "dodge") +
  theme_minimal()


ggplot(d) +
  aes(x = year |> as.factor(),
      group = rulemaking,
      fill = rulemaking ==1) +
  geom_bar() + #position = "dodge") +
  theme_minimal()

# by agency
d <- d |> unnest(agency) |>
  mutate(agency = str_squish(agency) ) |>
  add_count(agency) |>
  mutate(rank = dense_rank(n),
         top10 = rank > 10,
         agency10 = ifelse(top10, agency, "_Other"))


d |>
ggplot() +
  aes(x = year |> as.factor(),
      group = agency10,
      fill = agency10) +
  geom_bar() + #position = "dodge") +
  theme_minimal()

library(ggrepel)
d |>
  drop_na(year) |> 
  #filter(year > 2000) |>
ggplot() +
  aes(x = year |> as.factor() ,
      y = rule_comments_n |> log(),
      label = agency ) +
  geom_point() +
  geom_text_repel() +
  theme_minimal()


d |>
  rename(SCOTUS_year = year) |>
  pivot_longer(cols = c("statute_year", "SCOTUS_year", "rule_year")) |>
  ggplot() +
  aes(x = value  ,
      shape = name,
      y = log(rule_comments_n + 1) ,
      group = Case,
      color = agency10) +
  geom_point() +
  #geom_text_repel(aes(label = agency)) +
  geom_point() +
  geom_line() +
  #geom_text(aes(label = statute_year, x = as.factor(statute_year)), check_overlap = T) +
  #geom_text(aes(label = rule_year), check_overlap = T) +
  theme_minimal() +
  labs(x = "",
       color = "Federal Agency",
       shape = "Policy Decision",
       y = "log(public comments)")

d |> filter(rule_comments_n <1)

```
